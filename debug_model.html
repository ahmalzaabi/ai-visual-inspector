<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Model Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
</head>
<body>
    <h1>ESP32 Model Debug Test</h1>
    <div id="status">Loading...</div>
    <div id="results"></div>

    <script>
        async function testModel() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            
            try {
                statusEl.innerHTML = 'Initializing TensorFlow.js...';
                await tf.ready();
                console.log('TF.js ready, backend:', tf.getBackend());
                
                statusEl.innerHTML = 'Loading ESP32 model...';
                const model = await tf.loadGraphModel('/models/esp32/model.json');
                console.log('Model loaded successfully:', model);
                
                statusEl.innerHTML = 'Testing model prediction...';
                
                // Create test input
                const testInput = tf.zeros([1, 640, 640, 3]);
                console.log('Test input shape:', testInput.shape);
                
                // Run prediction
                const output = model.predict(testInput);
                console.log('Raw output:', output);
                
                // Handle different output formats
                if (Array.isArray(output)) {
                    console.log('Output is array with shapes:', output.map(t => t.shape));
                    resultsEl.innerHTML = `
                        <h3>✅ Model Working!</h3>
                        <p>Output type: Array of ${output.length} tensors</p>
                        <p>Shapes: ${output.map(t => t.shape.toString()).join(', ')}</p>
                    `;
                } else {
                    console.log('Output shape:', output.shape);
                    const data = await output.data();
                    console.log('First 10 values:', Array.from(data.slice(0, 10)));
                    
                    resultsEl.innerHTML = `
                        <h3>✅ Model Working!</h3>
                        <p>Output shape: ${output.shape}</p>
                        <p>First 10 values: ${Array.from(data.slice(0, 10)).map(v => v.toFixed(3)).join(', ')}</p>
                    `;
                }
                
                statusEl.innerHTML = '✅ Test completed successfully!';
                
                // Cleanup
                testInput.dispose();
                if (Array.isArray(output)) {
                    output.forEach(t => t.dispose());
                } else {
                    output.dispose();
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.innerHTML = '❌ Error occurred';
                resultsEl.innerHTML = `
                    <h3>❌ Error Details:</h3>
                    <pre>${error.message}</pre>
                    <pre>${error.stack}</pre>
                `;
            }
        }
        
        // Start test when page loads
        window.addEventListener('load', testModel);
    </script>
</body>
</html> 